<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Result - Exchange of Presents</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
<link href="static/styles.css" rel="stylesheet">
</head>

<body class="container mt-4">

<div class="text-end mb-3">
  <button class="btn btn-sm btn-outline-secondary" onclick="setLanguage('es')" data-i18n="lang_es"></button>
  <button class="btn btn-sm btn-outline-secondary" onclick="setLanguage('en')" data-i18n="lang_en"></button>
</div>

<div class="text-center">
  <h1 class="titulo-navidad" data-i18n="r_title"></h1>
  <div id="contenido" class="mt-4"></div>
</div>

<script src="static/i18n.js"></script>
<script src="static/lang.js"></script>
<script src="static/config.js"></script>

<script>
function api(path) {
  return `${window.BACKEND_BASE_URL}${path}`;
}

const id = new URLSearchParams(location.search).get("id");
const nombre = new URLSearchParams(location.search).get("nombre");

function renderNotAvailable() {
  document.getElementById("contenido").innerHTML =
    `<div class="alert alert-danger" role="alert">${t("r_not_available")}</div>`;
}

async function load() {
  if (!id || !nombre) {
    renderNotAvailable();
    return;
  }
  try {
    const r = await fetch(api(`/api/intercambio/${id}/resultado?nombre=${encodeURIComponent(nombre)}`));
    if (!r.ok) { renderNotAvailable(); return; }
    const data = await r.json();
    if (!data || !data.da || !data.recibe) { renderNotAvailable(); return; }

    document.getElementById("contenido").innerHTML = `
      <p class="subtitulo-navidad">
        <span>${t("r_you_are")}</span> <strong>${data.da}</strong>
      </p>
      <h4 class="mt-4">${t("r_you_give_to_label")}</h4>
      <h2 class="text-danger">${data.recibe}</h2>
    `;
  } catch {
    renderNotAvailable();
  }
}

window.onLanguageChanged = () => load();
document.addEventListener("DOMContentLoaded", load);
</script>

</body>
</html>
