<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin | Exchange of Presents</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
  <link href="static/styles.css" rel="stylesheet">
</head>

<body class="bg-light">
  <nav class="navbar navbar-dark bg-danger shadow">
    <div class="container d-flex flex-column align-items-center py-2">
      <span class="navbar-brand titulo-navidad mb-0">ğŸ Amigo Secreto ğŸ„</span>
      <span class="subtitulo-navidad">Intercambio DivisiÃ³n de Sistemas de InformaciÃ³n</span>
    </div>
  </nav>

  <main class="container my-4">
    <div class="card shadow mb-3">
      <div class="card-header bg-warning fw-bold">Acceso de Administrador</div>
      <div class="card-body">
        <label class="form-label fw-bold">Admin Token</label>
        <div class="input-group">
          <input id="adminToken" class="form-control" placeholder="Pega tu token admin">
          <button class="btn btn-outline-primary" onclick="guardarToken()">Guardar</button>
        </div>
        <div class="small text-muted mt-2">
          Se guarda en este navegador (localStorage). Los participantes no lo ven.
        </div>
      </div>
    </div>

    <div class="card shadow mb-3">
      <div class="card-header bg-success text-white fw-bold">Buscar intercambio existente</div>
      <div class="card-body">
        <div class="input-group">
          <input id="buscarId" class="form-control" placeholder="Ej. NAV-1A2B3C4D">
          <button class="btn btn-outline-light btn-success" onclick="buscarIntercambio()">Buscar</button>
        </div>
        <div class="small text-muted mt-2">
          Carga contador, participantes y estado para operar ese intercambio.
        </div>
      </div>
    </div>

    <div class="card shadow mb-4">
      <div class="card-header bg-warning fw-bold">Panel del Administrador</div>
      <div class="card-body">
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-navidad" onclick="generarId()">Generar ID</button>
          <button class="btn btn-primary" onclick="sortear()">Realizar sorteo</button>
          <button class="btn btn-danger" onclick="cerrarIntercambio()">Cerrar intercambio</button>

          <button class="btn btn-outline-secondary" onclick="resetIntercambio()">Reset (reabrir + quitar sorteo)</button>
          <button class="btn btn-outline-danger" onclick="eliminarIntercambio()">Eliminar intercambio</button>

          <button class="btn btn-success" onclick="exportarExcel()">Exportar Excel</button>
          <button class="btn btn-outline-info" onclick="cargarHistorial()">Historial</button>
        </div>

        <hr>

        <div class="row g-3 align-items-end">
          <div class="col-md-4">
            <label class="form-label fw-bold">ID del intercambio</label>
            <div class="input-group">
              <input id="id" class="form-control text-center fw-bold" readonly>
              <button class="btn btn-outline-secondary" onclick="copiar('id')">Copiar</button>
            </div>
          </div>

          <div class="col-md-8">
            <label class="form-label fw-bold">Link para participantes</label>
            <div class="input-group">
              <input id="link" class="form-control" readonly>
              <button class="btn btn-outline-secondary" onclick="copiar('link')">Copiar</button>
              <button class="btn btn-outline-success" onclick="abrirLink()">Abrir</button>
            </div>
          </div>

          <div class="col-md-12 text-center mt-3">
            <img id="qr" class="img-fluid border rounded p-2" style="max-width: 220px" alt="QR">
          </div>
        </div>

        <div class="alert alert-info mt-3 mb-0">
          Participantes registrados: <span id="contador" class="fw-bold">0</span>
          <span class="ms-3">Estado: <span id="estado" class="fw-bold">â€”</span></span>
        </div>

        <div id="toast" class="alert d-none mt-3" role="alert"></div>
      </div>
    </div>

    <div class="card shadow mb-4">
      <div class="card-header bg-success text-white fw-bold">Participantes</div>
      <div class="card-body table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr class="text-center">
              <th style="width: 60px">#</th>
              <th>Nombre</th>
              <th>WhatsApp</th>
              <th>Regalos</th>
              <th style="width: 260px">Token</th>
              <th style="width: 160px">Recibe</th>
            </tr>
          </thead>
          <tbody id="tablaParticipantes"></tbody>
        </table>
      </div>
    </div>

    <div class="card shadow mb-4">
      <div class="card-header bg-danger text-white fw-bold">Sorteo final (persistente)</div>
      <div class="card-body table-responsive">
        <table class="table table-bordered align-middle text-center">
          <thead class="table-light">
            <tr>
              <th style="width: 60px">#</th>
              <th>Da regalo</th>
              <th>Recibe</th>
              <th style="width: 200px">WhatsApp</th>
            </tr>
          </thead>
          <tbody id="tablaSorteo"></tbody>
        </table>
      </div>
    </div>

    <div class="card shadow">
      <div class="card-header bg-primary text-white fw-bold">Historial de intercambios</div>
      <div class="card-body table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light text-center">
            <tr>
              <th>ID</th>
              <th>Total</th>
              <th>Cerrado</th>
              <th>Sorteado</th>
              <th>AcciÃ³n</th>
            </tr>
          </thead>
          <tbody id="tablaHistorial"></tbody>
        </table>
      </div>
    </div>

    <div class="footer-navidad text-center mt-4 mb-5">
      ğŸ„ Exchange of Presents ğŸ
    </div>
  </main>

  <script src="static/config.js"></script>
  <script src="static/admin.js"></script>
</body>
</html>
