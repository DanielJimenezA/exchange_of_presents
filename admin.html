<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Exchange of Presents</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
<link href="static/styles.css" rel="stylesheet">
</head>

<body class="container mt-4">

<h1 class="titulo-navidad text-center">ğŸ Amigo Secreto ğŸ„</h1>
<p class="subtitulo-navidad text-center">Intercambio DivisiÃ³n de Sistemas de InformaciÃ³n</p>

<div class="card shadow p-4">
  <button class="btn btn-navidad mb-3" onclick="generar()">Generar ID de intercambio</button>

  <label>ID del intercambio</label>
  <div class="input-group mb-2">
    <input id="id" class="form-control" readonly>
    <button class="btn btn-outline-secondary" onclick="copiar('id')">Copiar</button>
  </div>

  <label>Link para participantes</label>
  <div class="input-group mb-2">
    <input id="link" class="form-control" readonly>
    <button class="btn btn-outline-secondary" onclick="copiar('link')">Copiar</button>
    <button class="btn btn-outline-success" onclick="abrir()">Abrir</button>
  </div>

  <div class="text-center mt-3">
    <img id="qr" style="max-width:200px">
  </div>
</div>

<div class="footer-navidad text-center mt-4">
ğŸ„ Exchange of Presents ğŸ
</div>

<script src="static/config.js"></script>
<script>
function api(p){ return BACKEND_BASE_URL + p }

function generar(){
  const intercambioId = "NAV-" + crypto.randomUUID().slice(0,8).toUpperCase();
  document.getElementById("id").value = intercambioId;

  const base = location.origin + location.pathname.replace("admin.html","");
  const link = base + "participante.html?id=" + intercambioId;
  document.getElementById("link").value = link;

  document.getElementById("qr").src =
    "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" +
    encodeURIComponent(link);

  fetch(api("/api/intercambio/crear"), {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ intercambio_id: intercambioId })
  });
}

function copiar(id){
  navigator.clipboard.writeText(document.getElementById(id).value);
}

function abrir(){
  window.open(document.getElementById("link").value,"_blank");
}
</script>

</body>
</html>
